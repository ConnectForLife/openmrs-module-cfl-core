<htmlform formUuid="k65f120a-04ec-11e3-8780-2b40bef9a44b" formName="CFL Visit Note Form" formEncounterType="d7151f82-c1f3-4152-a605-2f9ea7414a79" formVersion="1.0">
    <style type="text/css">
        #metadata {
            display: none;
        }

        .field-error {
            color: #ff6666;
            font-size: 1.1em;
            display: block;
        }

        <ifMode mode="VIEW" include="false">
            #data-collection {
                display: inline-block;
                width: 58%;
                vertical-align: top;
            }
            #encounter-diagnoses-target {
                display: inline-block;
                width: 40%;
                vertical-align: top;
            }

            #encounter-diagnoses-app {
                margin-bottom: 20px;
            }
        </ifMode>
    </style>

    <script type="text/javascript">
        jQuery(document).ready(function(){
            var dateToDMY = function dateToDMY(date) {
                var d = date.getDate();
                var m = date.getMonth() + 1; //Month from 0 to 11
                var y = date.getFullYear();
                return '' + (d > 9 ? d : '0' + d) + '.' + (m > 9 ? m : '0' + m ) + '.' + y;
            };

            var actualDate = jQuery('#encounterDate > input').val();
            jQuery('#actualDate').text(dateToDMY(new Date(actualDate)));

            var plannedDate = jQuery('#plannedDate').text();
            jQuery('#plannedDate').text(dateToDMY(new Date(plannedDate)));
        });
    </script>

    <ifMode mode="VIEW" include="false">
        <h2><uimessage code="referenceapplication.visitNote.title"/></h2>
        <div>
            <span>
                for planned visit:
            </span>
            <span id="plannedDate">
                <lookup expression="visit.startDatetime"/>
            </span>
            <span>
                , actual visit:
            </span>
            <span id="actualDate" />
            <encounterDate id="encounterDate" default="now" widget="hidden"/>
        </div>
        <div id="metadata">
            <p>
                <label><uimessage code="coreapps.patientDashBoard.provider"/></label>
                <span><encounterProvider default="currentUser" required="true"  /></span>
            </p>
            <p>
                <label><uimessage code="coreapps.patientDashBoard.location"/></label>
                <span><encounterLocation default="SessionAttribute:emrContext.sessionLocationId"/></span>
            </p>
        </div>
    </ifMode>
    <div id="note">
        <p>
            <label><uimessage code="coreapps.consult.freeTextComments"/></label>
            <obs conceptId="CIEL:162169" style="textarea" rows="5"/>
        </p>
    </div>

    <div id="data-collection">
        <encounterDiagnoses required="true" selectedDiagnosesTarget="#encounter-diagnoses-target"/>
    </div>

    <div id="encounter-diagnoses-target">
    </div>

    <ifMode mode="VIEW" include="false">
        <div id="buttons">
            <submit submitClass="confirm right" submitCode="general.save"/>
            <button type="button" class="cancel"><uimessage code="general.cancel"/></button>
        </div>
    </ifMode>
</htmlform>